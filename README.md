# Photo-OCR — распознавание цифр в клетках Sudoku (ветка `Photo-OCR`)

**Кратко**  
Проект создан для личного обучения и пополнения резюме (цель — позиция backend-разработчика). Основная система находит поле Sudoku на экране, распознаёт цифры в 9×9 поле, решает головоломку и заполняет её. Эта ветка (`Photo-OCR`) отвечает за этап OCR — подготовку данных, разметку, дообучение EasyOCR и инференс по отдельным клеткам.

---

## Цель ветки
- Автоматизировать сбор изображений клеток из скриншотов/фото игрового поля.  
- Собрать аннотированный датасет ячеек (пустая/цифра).  
- Дообучить EasyOCR (fine-tune) под формат и стиль цифр в играх/сайтах.  
- Обеспечить модуль распознавания, который отдаёт 9×9 матрицу значений для следующего этапа — решения и автозаполнения.

---

## Структура репозитория (только реальные файлы/папки в ветке)

```
/ (корень ветки Photo-OCR)
├─ .vscode/               # (опционально) настройки редактора
├─ annotations/           # (если есть) метаданные/разметка
├─ dataset/               # подготовленные/сырые изображения ячеек и/или подпапки
├─ scripts/               # вспомогательные утилиты (аугментация/преобработка) — см. ниже
├─ src/                   # основной код инференса / обучения — см. ниже
├─ .gitignore
├─ EXAMPLE_RUN.txt
├─ README.md              # этот файл
├─ collect_data.py        # 1. сбор и резка поля на 81 клетку
├─ renaming.py            # 2. перевод названий в сквозную нумерацию
├─ moving.py              # 3. ручная разметка (ввод цифры с клавиатуры)
├─ csving.py              # 4. создание CSV с метками
├─ start_train.py         # 5. запуск дообучения EasyOCR
├─ predictions.csv        # пример / результаты инференса (если присутствует)
└─ requirements.txt       # зависимости
```


---

## Подробное описание скриптов (в порядке запуска)



### 1. `collect_data.py`  
**Назначение:** интерактивный сбор данных с экрана.  
**Что делает:**
- Запрашивает у пользователя координаты мыши: верхний-левый и нижний-правый углы поля Sudoku; дополнительно — координаты кнопок «Новая игра» и «Лёгкий уровень» (для автоматизации смены поля).
- Вырезает указанную область и делит её на 9×9 = 81 изображение-ячейку.
- Сохраняет каждую ячейку с именем формата: `cell-{номер поля}-{строка}-{столбец}.jpg` (например `cell-3-5-7.jpg`).

**Практика:** выполните сбор в стабильных условиях (фиксированное окно приложения/браузера и масштаб ОС) — это повышает качество датасета.

---

### 2. `renaming.py`  
**Назначение:** нормализация имён файлов для удобства последующей обработки.  
**Что делает:**
- Переводит именование клеток в сквозную - единый формат, удобный для датасета.

**Практика:** запускайте после `collect_data.py`, если хотите объединить файлы из разных серий в один плоский набор.

---

### 3. `moving.py`  
**Назначение:** быстрая ручная разметка изображений.  
**Что делает:**
- Показывает одну ячейку на экране и ждёт ввода от пользователя: цифры 1–9, для пустой клетки — можно нажать любую клавишу.
- После ввода переносит/копирует файл в соответствующую подпапку `dataset/<label>/`.
- Позволяет быстро размечать большие наборы вручную.


---

### 4. `csving.py`  
**Назначение:** формирование таблицы меток.  
**Что делает:**
- Проходит по размеченным файлам и генерирует CSV вида `filename,label`  — готовый к использованию скриптами обучения.



---

### 5. `start_train.py`  
**Назначение:** запуск процесса дообучения (fine-tuning) EasyOCR на подготовленных данных.  
**Что делает :**
- Загружает метаданные из `dataset/` и CSV.
- Формирует даталоадеры (preprocessing, transform, batching).
- Настраивает и запускает процесс обучения/валидации EasyOCR (или соседнего пайплайна).
- Сохраняет финальные веса/чекпойнты и логи/метрики.

**Практика:** проверьте внутри скрипта параметры (epochs, batch_size, lr, device)

---

## Папки `src/` и `scripts/`


- `src/` — основная логика проекта: модули инференса (обёртка EasyOCR), сборка распознанных символов в матрицу 9×9, утилиты для предобработки и постобработки, возможный модуль оценки (accuracy, confusion matrix).  
- `scripts/` — вспомогательные скрипт: аугментации.  


---

## Формат данных и CSV

**Формат изображений:** JPG, отдельный файл на каждую ячейку и его расшифровка.

**Пример CSV (`csving.py` → `dataset/labels.csv`):**
```
filename,label
./1/1.jpg,1
./9/35.jpg,9
./empty/50.jpg,
...
```
- label: `1`..`9` — цифры, `(пусто)` — пустая клетка.


---

## Установка зависимостей

В корне репозитория есть `requirements.txt`. Стандартная последовательность:

```bash
pip install -r requirements.txt
```

**Важно по EasyOCR / PyTorch:** EasyOCR требует PyTorch. Для GPU-поддержки установите `torch` с подходящей версией CUDA согласно инструкциям на https://pytorch.org. `pip install torch` может установить CPU-версию — проверьте вывод.

---

## Пример полного рабочегo сценария (быстрый старт)

1. Установите зависимости (см. выше).  
2. Соберите несколько полей:
   ```bash
   python collect_data.py
   ```
   — ввод координат области экрана → сохранение ~81 изображений ячеек.

3. При необходимости приведите имена к единому формату:
   ```bash
   python renaming.py
   ```

4. Разметьте вручную:
   ```bash
   python moving.py
   ```
   — ввод цифры с клавиатуры; пустые клетки — любой иной ввод.

5. Создайте CSV:
   ```bash
   python csving.py
   ```

6. Запустите дообучение:
   ```bash
   python start_train.py
   ```
   — проверьте внутри скрипта/CLI параметры (epochs, batch_size, device).

7. Инференс: используйте модуль в `src/inference_cnn.py` для распознавания ячеек.


